SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "+00:00";
CREATE DATABASE IF NOT EXISTS `mrdb` DEFAULT CHARACTER SET latin1 COLLATE latin1_swedish_ci;
USE `mrdb`;

CREATE TABLE IF NOT EXISTS `Accident` (
  `dID` int(11) NOT NULL,
  `Cause` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`dID`),
  UNIQUE KEY `dID` (`dID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `Arrives_At` (
  `vID` int(11) NOT NULL,
  `sNo` int(11) NOT NULL,
  `aTime` bigint(255) NOT NULL,
  PRIMARY KEY (`vID`,`sNo`),
  UNIQUE KEY `uVS` (`vID`,`sNo`),
  KEY `sNo` (`sNo`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `Bus` (
  `ID` int(11) NOT NULL,
  `Plate` varchar(255) NOT NULL,
  `Length` int(11) NOT NULL,
  PRIMARY KEY (`ID`),
  UNIQUE KEY `ID` (`ID`),
  UNIQUE KEY `Plate` (`Plate`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `Delay` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `Origin` varchar(255) NOT NULL,
  `Description` varchar(255) DEFAULT NULL,
  `dStart` bigint(255) NOT NULL,
  `dEnd` bigint(255) DEFAULT NULL,
  `sNo` int(11) NOT NULL,
  PRIMARY KEY (`ID`),
  UNIQUE KEY `ID` (`ID`),
  KEY `sNo` (`sNo`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=2 ;

CREATE TABLE IF NOT EXISTS `Departs_From` (
  `vID` int(11) NOT NULL,
  `sNo` int(11) NOT NULL,
  `dTime` bigint(255) NOT NULL,
  PRIMARY KEY (`vID`,`sNo`),
  UNIQUE KEY `uVS` (`vID`,`sNo`),
  KEY `sNo` (`sNo`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `Environmental` (
  `dID` int(11) NOT NULL,
  `Type` varchar(255) NOT NULL,
  PRIMARY KEY (`dID`),
  UNIQUE KEY `dID` (`dID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `Lays_Between` (
  `Prev_no` int(11) NOT NULL DEFAULT '0',
  `Next_no` int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (`Prev_no`,`Next_no`),
  UNIQUE KEY `uPN` (`Prev_no`,`Next_no`),
  KEY `Next_no` (`Next_no`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `Maintenance` (
  `dID` int(11) NOT NULL,
  PRIMARY KEY (`dID`),
  UNIQUE KEY `dID` (`dID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `Other` (
  `dID` int(11) NOT NULL,
  PRIMARY KEY (`dID`),
  UNIQUE KEY `dID` (`dID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `Route` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `rStart` int(11) NOT NULL,
  `rEnd` int(11) NOT NULL,
  `Num_stops` int(11) NOT NULL,
  PRIMARY KEY (`ID`),
  UNIQUE KEY `ID` (`ID`),
  KEY `rStart` (`rStart`),
  KEY `rEnd` (`rEnd`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=203 ;

CREATE TABLE IF NOT EXISTS `Stop` (
  `No` int(11) NOT NULL AUTO_INCREMENT,
  `Location` varchar(255) NOT NULL,
  `rID` int(11) NOT NULL,
  PRIMARY KEY (`No`),
  UNIQUE KEY `No` (`No`),
  KEY `rID` (`rID`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=18 ;

CREATE TABLE IF NOT EXISTS `Train` (
  `ID` int(11) NOT NULL,
  `Num_cars` int(11) NOT NULL,
  PRIMARY KEY (`ID`),
  UNIQUE KEY `ID` (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `Vehicle` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `Capacity` int(11) NOT NULL,
  `rID` int(11) NOT NULL,
  PRIMARY KEY (`ID`),
  UNIQUE KEY `ID` (`ID`),
  KEY `rID` (`rID`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=4 ;


ALTER TABLE `Accident`
  ADD CONSTRAINT `Accident_ibfk_1` FOREIGN KEY (`dID`) REFERENCES `Delay` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `Arrives_At`
  ADD CONSTRAINT `Arrives_At_ibfk_1` FOREIGN KEY (`vID`) REFERENCES `Vehicle` (`ID`) ON UPDATE CASCADE,
  ADD CONSTRAINT `Arrives_At_ibfk_2` FOREIGN KEY (`sNo`) REFERENCES `Stop` (`No`) ON UPDATE CASCADE;

ALTER TABLE `Bus`
  ADD CONSTRAINT `Bus_ibfk_1` FOREIGN KEY (`ID`) REFERENCES `Vehicle` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `Delay`
  ADD CONSTRAINT `Delay_ibfk_1` FOREIGN KEY (`sNo`) REFERENCES `Stop` (`No`) ON UPDATE CASCADE;

ALTER TABLE `Departs_From`
  ADD CONSTRAINT `Departs_From_ibfk_1` FOREIGN KEY (`vID`) REFERENCES `Vehicle` (`ID`) ON UPDATE CASCADE,
  ADD CONSTRAINT `Departs_From_ibfk_2` FOREIGN KEY (`sNo`) REFERENCES `Stop` (`No`) ON UPDATE CASCADE;

ALTER TABLE `Environmental`
  ADD CONSTRAINT `Environmental_ibfk_1` FOREIGN KEY (`dID`) REFERENCES `Delay` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `Lays_Between`
  ADD CONSTRAINT `Lays_Between_ibfk_1` FOREIGN KEY (`Prev_no`) REFERENCES `Stop` (`No`) ON UPDATE CASCADE,
  ADD CONSTRAINT `Lays_Between_ibfk_2` FOREIGN KEY (`Next_no`) REFERENCES `Stop` (`No`) ON UPDATE CASCADE;

ALTER TABLE `Maintenance`
  ADD CONSTRAINT `Maintenance_ibfk_1` FOREIGN KEY (`dID`) REFERENCES `Delay` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `Other`
  ADD CONSTRAINT `Other_ibfk_1` FOREIGN KEY (`dID`) REFERENCES `Delay` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `Route`
  ADD CONSTRAINT `Route_ibfk_1` FOREIGN KEY (`rStart`) REFERENCES `Stop` (`No`) ON UPDATE CASCADE,
  ADD CONSTRAINT `Route_ibfk_2` FOREIGN KEY (`rEnd`) REFERENCES `Stop` (`No`) ON UPDATE CASCADE;

ALTER TABLE `Stop`
  ADD CONSTRAINT `Stop_ibfk_1` FOREIGN KEY (`rID`) REFERENCES `Route` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `Train`
  ADD CONSTRAINT `Train_ibfk_1` FOREIGN KEY (`ID`) REFERENCES `Vehicle` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `Vehicle`
  ADD CONSTRAINT `Vehicle_ibfk_1` FOREIGN KEY (`rID`) REFERENCES `Route` (`ID`) ON UPDATE CASCADE;
